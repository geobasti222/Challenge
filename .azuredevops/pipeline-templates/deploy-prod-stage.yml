# Production Deployment Template
- stage: Deploy_Prod
  displayName: 'Deploy to Production'
  dependsOn: Test
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  jobs:
  - deployment: Deploy_Production
    displayName: 'Deploy to Production Environment'
    pool:
      vmImage: $(vmImage)
    environment: 'Production'
    strategy:
      runOnce:
        deploy:
          steps:
          - checkout: self
          - download: current
            artifact: manifests

          - template: .azuredevops/pipeline-templates/apim-setup.yml
          - template: .azuredevops/pipeline-templates/aks-deploy.yml
          - template: .azuredevops/pipeline-templates/finalize-deploy.yml